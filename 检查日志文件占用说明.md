# 检查日志文件占用说明

当运行 `runAiBot.py` 时如果出现"日志文件被其他程序使用"的错误，可以使用以下方法查看和解决。

## 方法一：使用 PowerShell 脚本（推荐）

1. 在项目根目录打开 PowerShell
2. 运行：
```powershell
.\check_file_locks.ps1
```

脚本会自动检查以下日志文件：
- `logs\log.txt`
- `logs\experience_analysis.log`

## 方法二：使用批处理脚本

1. 双击运行 `check_file_locks.bat`
2. 如果已安装 Sysinternals Handle 工具，会自动显示占用文件的进程

## 方法三：手动检查（Windows）

### 使用任务管理器

1. 按 `Ctrl + Shift + Esc` 打开任务管理器
2. 在"详细信息"标签页中查找：
   - `python.exe` 或 `pythonw.exe` 进程（可能有多个实例）
   - 文本编辑器进程（如 `notepad++.exe`, `Code.exe`, `notepad.exe`）
3. 结束可能占用文件的进程

### 使用资源监视器

1. 按 `Win + R`，输入 `resmon` 并回车
2. 切换到"CPU"标签页
3. 在"关联的句柄"搜索框中输入：`log.txt` 或 `experience_analysis.log`
4. 查看哪些进程正在使用这些文件

### 使用命令行（需要管理员权限）

```cmd
# 使用 openfiles 命令（需要先启用）
openfiles /query /fo table | findstr /i "log.txt"

# 或使用 PowerShell
Get-Process | Where-Object {$_.Path} | ForEach-Object {
    try {
        $_.OpenFiles() | Where-Object {$_.FileName -like "*log*"}
    } catch {}
}
```

## 常见原因

1. **文本编辑器打开了日志文件**
   - Notepad++
   - VS Code
   - Notepad
   - 其他文本编辑器

2. **另一个 Python 脚本实例正在运行**
   - 检查任务管理器中的 Python 进程
   - 确保没有重复运行脚本

3. **文件资源管理器正在预览文件**
   - 关闭文件资源管理器窗口
   - 或在文件资源管理器中关闭预览窗格

4. **防病毒软件正在扫描文件**
   - 临时禁用实时保护
   - 或将日志文件夹添加到排除列表

## 解决方法

1. **关闭所有可能打开日志文件的程序**
2. **结束重复的 Python 进程**
3. **重启脚本**
4. **如果问题持续，重启计算机**

## 代码改进

代码已改进，现在包含：
- 自动重试机制（最多 3 次）
- 指数退避策略
- 更好的错误处理
- 自动创建日志目录

如果文件被占用，脚本会自动重试，减少失败的可能性。

